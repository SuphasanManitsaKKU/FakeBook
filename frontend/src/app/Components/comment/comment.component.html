<div class="comments mt-6">
  <!-- ‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á parentComments -->
  <ng-container *ngFor="let comment of parentComments">
    <div class="comment mb-4 p-4 bg-gray-100 rounded-lg flex items-start w-full">
      
      <!-- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
      <img
        [src]="comment.user.imageProfile ? comment.user.imageProfile : 'default-profile.png'"
        alt="Profile Image"
        class="w-10 h-10 rounded-full mr-3"
      />

      <div class="w-full">
        <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <p class="text-sm font-semibold">{{ comment.user.username }}</p>

        <!-- ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) -->
        <p *ngIf="editingCommentId !== comment.id" class="text-gray-700 text-base">
          {{ comment.message }}
        </p>

        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå -->
        <div *ngIf="editingCommentId === comment.id">
          <input
            type="text"
            [(ngModel)]="editedMessage"
            class="w-full p-2 border rounded-md"
          />
          <button class="bg-green-500 text-white py-1 px-2 rounded-md mt-2" (click)="saveEdit(comment)">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
          </button>
          <button class="text-gray-500 ml-2" (click)="stopEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÉ‡∏ï‡πâ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå -->
        <div class="flex gap-2 mt-2">
          <!-- ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö -->
          <button class="text-blue-500 hover:underline" (click)="startReply(comment.id)">‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</button>
          <!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
          <button class="text-yellow-500 hover:underline" (click)="startEdit(comment)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <!-- ‡∏•‡∏ö -->
          <button class="text-red-500 hover:underline" (click)="deleteComment(comment.id)">‡∏•‡∏ö</button>
        </div>

        <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á input-comment ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡∏Å‡∏î reply) -->
        <div *ngIf="replyingToCommentId === comment.id" class="mt-2">
          <app-input-comment
            [postId]="postId"
            [parentCommentId]="comment.id"
            (commentAdded)="onCommentAddedFromChild()"
          ></app-input-comment>
          <button class="text-gray-500 mt-2" (click)="stopReply()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏•‡∏π‡∏Å (Replies) -->
        <div class="nested-comments mt-4 ml-4 border-l border-gray-300 pl-3 w-[97.5%]">
          <ng-container *ngFor="let reply of repliesMap[comment.id]">
            <div class="reply mb-2 p-3 bg-gray-200 rounded-lg flex items-start w-full">
              <!-- ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ reply -->
              <img
                [src]="reply.user.imageProfile ? reply.user.imageProfile : 'default-profile.png'"
                alt="Profile Image"
                class="w-8 h-8 rounded-full mr-3"
              />
              <div class="w-full">
                <p class="text-sm font-semibold">{{ reply.user.username }}</p>
                <p class="text-gray-700 text-sm">
                  {{ reply.message }}
                </p>
                <div class="flex gap-2 mt-1">
                  <button class="text-blue-500 hover:underline" (click)="startReply(reply.id)">‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</button>
                  <button class="text-yellow-500 hover:underline" (click)="startEdit(reply)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button class="text-red-500 hover:underline" (click)="deleteComment(reply.id)">‡∏•‡∏ö</button>
                </div>

                <!-- ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ã‡πâ‡∏≥ -->
                <div *ngIf="replyingToCommentId === reply.id" class="mt-2">
                  <app-input-comment
                    [postId]="postId"
                    [parentCommentId]="reply.id"
                    (commentAdded)="onCommentAddedFromChild()"
                  ></app-input-comment>
                  <button class="text-gray-500 mt-1" (click)="stopReply()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- üîπ InputComment ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡πÉ‡∏Ñ‡∏£) -->
  <div class="mt-6">
    <app-input-comment
      [postId]="postId"
      [parentCommentId]="null"
      (commentAdded)="loadComments(); onCommentAddedFromChild()" 
      >
    </app-input-comment>
  </div>
</div>
